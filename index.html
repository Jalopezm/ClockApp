<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link href="css/style.css" rel="stylesheet" />
    <title>ClockApp</title>
  </head>

  <body>
    <button class="tablink" id="defaultOpen" onclick="openPage('clock')">Clock</button>
    <button class="tablink" onclick="openPage('timer')">Timer</button>
    <button class="tablink" onclick="openPage('stopwatch')">StopWatch</button>
    <button class="tablink" onclick="openPage('alarm')">Alarms</button>

    <div id="clock" class="tabcontent">
      <h1>Clock</h1>
      <span id="clockView"></span>
    </div>

    <div id="stopwatch" class="tabcontent">
      <h1>StopWatch</h1>

      <div id="stopWatchTime">00:00:00:000</div>
      <button id="start" onclick="stopWatchStart()">Start</button>
      <button id="stop" onclick="stopWatchStop()">Stop</button>
      <button id="reset" onclick="stopWatchReset()">Reset</button>
    </div>

    <div id="alarm" class="tabcontent">
      <h1>Alarms</h1>
      <span class="timeis" id="time"></span>
      <input type="datetime-local" id="datetime" />
      <div id="alarmList"></div>
      <button id="Add" onclick="saveAlarm()">Add Alarm</button>
    </div>
    <script>
      /**/
      document.getElementById("defaultOpen").click();
      function openPage(pageName) {
        var i, tabcontent, tablinks;
        tabcontent = document.getElementsByClassName("tabcontent");
        for (i = 0; i < tabcontent.length; i++) {
          tabcontent[i].style.display = "none";
        }

        tablinks = document.getElementsByClassName("tablink");
        for (i = 0; i < tablinks.length; i++) {
          tablinks[i].style.backgroundColor = "";
        }
        document.getElementById(pageName).style.display = "block";
      }

      /*SCRIPT RELOJ*/
      setInterval(clock, 1000);

      function clock() {
        let date = new Date();
        document.getElementById("clockView").innerHTML =
          date.toLocaleTimeString();
        document.getElementById("time").innerHTML = date.toLocaleTimeString();
      }

      /*SCRIPT CRONOMETRO*/
      let seconds = 0;
      let min = 0;
      let hour = 0;
      let milliS = 0;
      let time = 0;
      let stopWatchTimeForm;
      let stopWatchStartInter;
      let timeMs;
      let timeToStart;
      const btnStop = (document.getElementById("stop").disabled = true);

      function stopWatchReset() {
        const btnStop = (document.getElementById("stop").disabled = true);
        const btnStart = (document.getElementById("start").disabled = false);
        timeMs = new Date().getTime();
        timeToStart = new Date();
        clearInterval(stopWatchStartInter);
        document.getElementById("stopWatchTime").innerHTML = "00:00:00:000";
      }

      function stopWatchStart() {
        timeToStart = new Date();
        const btnStop = (document.getElementById("stop").disabled = false);
        stopWatchStartInter = setInterval(stopWatch, 10);
      }

      function stopWatchStop() {
        const btnStart = (document.getElementById("start").disabled = false);
        const btnStop = (document.getElementById("stop").disabled = true);

        clearInterval(stopWatchStartInter);
      }

      function stopWatch() {
        console.log(timeToStart);
        const btnStart = (document.getElementById("start").disabled = true);
        let actualTime = new Date();
        time = actualTime - timeToStart;
        timeMs = new Date(time).getTime();

        stopWatchTimeForm = new Date(timeMs).toISOString().slice(11, -1);

        document.getElementById("stopWatchTime").innerHTML = stopWatchTimeForm;
      }

      /*SCRIPT ALARMAS*/
      let activeButton;
      let alarms = new Array();
      let li;
      let active = false;
      let currAlarm = new Date(
        document.getElementById("datetime").value + ":00"
      );
      alarm();
      function alarm() {
        let time = Math.floor(new Date().getTime() / 1000);
        checkAlarms(time);
      }

      function checkAlarms(time) {
        alarms.forEach((element) => {
          let alarm = element.ms;
          console.log("Alarma:" + alarm);
          console.log("Hora:" + time);
          if (alarm == time) {
            const audio = new Audio("audio");
            audio.play();
          }
        });
      }
      setInterval(alarm, 1000);
      function saveAlarm() {
        currAlarm = new Date(document.getElementById("datetime").value + ":00");
        let ms = Math.floor(currAlarm.getTime() / 1000);
        currAlarmTime = currAlarm.toLocaleTimeString();
        let alarmsValues = [currAlarmTime, active, ms];

        const objectAlarmsValues = JSON.parse(
          `{"currAlarmTime":"${currAlarmTime}","active":${active},"ms":"${ms}"}`
        );

        alarms.push(objectAlarmsValues);
        localStorageAlarm(JSON.stringify(alarms));
        displayAlarms();
      }

      function localStorageAlarm(alarms) {
        localStorage.setItem("alarms", alarms);
      }

      function displayAlarms() {
        document.getElementById("alarmList").innerHTML = "";
        alarms.forEach((element) => {
          activeButton = document.createElement("button");
          activeButton.innerHTML = "Activate";
          li = document.createElement("li");
          li.innerHTML = element.currAlarmTime;
          document.getElementById("alarmList").appendChild(li);
          document.getElementById("alarmList").appendChild(activeButton);
          activeButton.setAttribute("onclick", "activeAlarm()");
        });
      }
      function activeAlarm() {
        if (active == false) {
          active = true;
          activeButton.innerHTML = "Desactivate";
        } else {
          active = false;
          activeButton.innerHTML = "Activate";
        }
      }

      /*SCRIPT TIMER*/
    </script>
  </body>
</html>
